<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>Linxhub | Access Content</title>
  <style>
    /* --- OLD PREMIUM COLORS & BACKGROUND --- */
    body { 
      margin: 0; padding: 0; 
      background-color: #010a1a; 
      font-family: 'Inter', -apple-system, sans-serif; 
      color: #ffffff; 
      width: 100vw; height: 100vh; 
      overflow: hidden; 
      display: flex; align-items: center; justify-content: center; 
    }

    .ambient-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: #010a1a; }
    .blob { position: absolute; width: 600px; height: 600px; background: radial-gradient(circle, #0045ff 0%, #00d2ff 30%, transparent 70%); filter: blur(80px); -webkit-filter: blur(80px); border-radius: 50%; opacity: 0.4; top: -10%; left: -10%; }
    .blob-2 { position: absolute; width: 500px; height: 500px; background: radial-gradient(circle, #00d2ff 0%, transparent 70%); filter: blur(80px); -webkit-filter: blur(80px); border-radius: 50%; opacity: 0.3; bottom: -10%; right: -10%; }

    /* --- GLASSMORPHISM CARD --- */
    .glass-card { 
      position: relative; 
      background: rgba(255, 255, 255, 0.08); 
      backdrop-filter: blur(25px); 
      -webkit-backdrop-filter: blur(25px); 
      border: 1px solid rgba(255, 255, 255, 0.2); 
      border-radius: 35px; 
      padding: 40px 25px; 
      text-align: center; 
      width: 85%; max-width: 320px; 
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5); 
    }

    h1 { font-size: 1.7rem; font-weight: 800; margin: 0 0 10px; letter-spacing: -0.5px; }
    p { font-size: 14px; color: rgba(255, 255, 255, 0.6); margin-bottom: 30px; line-height: 1.5; }

    /* --- LOADER --- */
    .loader-container { position: relative; width: 80px; height: 80px; margin: 0 auto 30px; display: none; }
    svg { transform: rotate(-90deg); width: 80px; height: 80px; }
    circle { fill: none; stroke-width: 6; stroke: rgba(255, 255, 255, 0.1); }
    .progress { stroke: #00d2ff; stroke-dasharray: 226; stroke-dashoffset: 226; transition: stroke-dashoffset 0.1s linear; }

    /* --- BUTTONS --- */
    .btn { 
      width: 100%; padding: 18px; border-radius: 18px; border: none; 
      font-size: 14px; font-weight: 700; cursor: pointer; 
      text-transform: uppercase; letter-spacing: 1px; 
      margin-bottom: 12px; transition: 0.3s; 
    }
    
    .btn-primary { background: #ffffff; color: #000000; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255,255,255,0.2); }

    .btn-disabled { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.2); cursor: not-allowed; }
    
    .btn-active { 
      background: #ffffff; /* Matching your old "Link එක ගන්න" style */
      color: #000000; 
      cursor: pointer; 
      box-shadow: 0 0 20px rgba(0, 210, 255, 0.3);
    }
  </style>
</head>
<body>

  <div class="ambient-container">
    <div class="blob"></div>
    <div class="blob-2"></div>
  </div>

  <div class="glass-card">
    <h1 id="title">Loading...</h1>
    <p id="msg">Please wait while we fetch your link.</p>
    
    <div class="loader-container" id="lBox">
      <svg viewBox="0 0 100 100">
        <circle cx="50" cy="50" r="36"></circle>
        <circle cx="50" cy="50" r="36" class="progress" id="dot"></circle>
      </svg>
    </div>

    <button id="btn1" class="btn btn-primary" style="display:none;">Unlock Step 1</button>
    <button id="btn2" class="btn btn-primary" style="display:none;">Unlock Step 2</button>
    <button id="btnFinal" class="btn btn-disabled" disabled>Get Link</button>
  </div>

  <script>
   const DB_URL = "https://getlinx-a2z-default-rtdb.firebaseio.com/links/";
   
   // --- ID EXTRACTION ---
   const urlParams = new URLSearchParams(window.location.search);
   let id = urlParams.get('id');
   if (!id) {
     const path = window.location.pathname.split('/').filter(s => s);
     id = path[path.length - 1];
   }

   // --- ELEMENTS ---
   const els = {
     title: document.getElementById('title'),
     msg: document.getElementById('msg'),
     lBox: document.getElementById('lBox'),
     dot: document.getElementById('dot'),
     b1: document.getElementById('btn1'),
     b2: document.getElementById('btn2'),
     bFinal: document.getElementById('btnFinal')
   };

   let dataStore = {};

   // --- INITIAL FETCH ---
   if (id) {
     fetch(`${DB_URL}${id}.json`)
       .then(r => r.json())
       .then(data => {
         if (data && data.t) {
           dataStore = data;
           els.title.innerText = "Link Loaded";
           els.msg.innerText = "Click කරලා ටිකකින් Back වෙන්න.";
           
           // Logic to show m1 or m2 based on what exists
           if (data.m1) els.b1.style.display = "block";
           else if (data.m2) els.b2.style.display = "block";
           else unlockFinal();
         } else {
           els.msg.innerText = "Invalid or Expired Link.";
         }
       })
       .catch(() => {
         els.msg.innerText = "Connection Error.";
       });
   }

   // --- TIMER LOGIC ---
   function runTimer(callback) {
     els.lBox.style.display = 'block';
     els.msg.innerText = "Verifying...";
     let t = 0, limit = 4000, dash = 226;
     let interval = setInterval(() => {
       t += 50;
       els.dot.style.strokeDashoffset = dash - (t/limit)*dash;
       if (t >= limit) {
         clearInterval(interval);
         els.lBox.style.display = 'none';
         callback();
       }
     }, 50);
   }

   function handleAdClick(url, nextStepFn) {
     window.open(url, '_blank');
     this.style.display = 'none'; 
     runTimer(nextStepFn);
   }

   // Button 1 Click
   els.b1.onclick = function() {
     handleAdClick.call(this, dataStore.m1, () => {
       if (dataStore.m2) {
         els.msg.innerText = "One more step...";
         els.b2.style.display = "block";
       } else {
         unlockFinal();
       }
     });
   };

   // Button 2 Click
   els.b2.onclick = function() {
     handleAdClick.call(this, dataStore.m2, () => {
       unlockFinal();
     });
   };

   function unlockFinal() {
     els.msg.innerText = "Authenticated ✅";
     els.bFinal.disabled = false;
     els.bFinal.classList.remove('btn-disabled');
     els.bFinal.classList.add('btn-active');
     els.bFinal.innerText = "Link එක ගන්න"; // Using your original button text
     els.bFinal.onclick = () => window.location.href = dataStore.t;
   }
  </script>
</body>
</html>
